# cross check again

CREATE TABLE branch(
br_code INT(11) NOT NULL AUTO_INCREMENT,
br_street VARCHAR(30) NOT NULL,
br_num INT(4) NOT NULL,
br_city VARCHAR(30) NOT NULL,
PRIMARY KEY(br_code));

CREATE TABLE worker(
wrk_AT CHAR(10) NOT NULL,
wrk_name VARCHAR(20) NOT NULL,
wrk_lname VARCHAR(20) NOT NULL,
wrk_salary FLOAT(7,2) NOT NULL,
wrk_br_code INT(11) NOT NULL,
PRIMARY KEY (wrk_AT),
FOREIGN KEY (wrk_br_code) REFERENCES branch (br_code)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE manages(
mng_adm_AT CHAR(10) NOT NULL,
mng_br_code INT(11) NOT NULL,
PRIMARY KEY(mng_adm_AT,mng_br_code),
FOREIGN KEY (mng_adm_AT) REFERENCES admin (adm_AT)
ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (mng_br_code) REFERENCES branch (br_code)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE phones(
ph_br_code INT(11) NOT NULL,
ph_number CHAR(10) NOT NULL,
PRIMARY KEY(ph_br_code,ph_number),
FOREIGN KEY (ph_br_code) REFERENCES branch (br_code)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE driver(
drv_AT char(10) NOT NULL,
drv_license ENUM('A','B','C','D') NOT NULL,
drv_route ENUM('LOCAL','ABROAD') NOT NULL,
drv_experience TINYINT(4) DEFAULT 0,
PRIMARY KEY(drv_AT),
FOREIGN KEY(drv_AT) REFERENCES worker (wrk_AT)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE guide(
gui_AT CHAR(10) NOT NULL,
gui_CV TEXT,
PRIMARY KEY (gui_AT),
FOREIGN KEY (gui_AT) REFERENCES worker (wrk_AT)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE languages(
lng_gui_AT CHAR(10) NOT NULL,
lng_language VARCHAR(30) NOT NULL,
PRIMARY KEY(lng_gui_AT,lng_language),
FOREIGN KEY(lng_gui_AT) REFERENCES guide (gui_AT)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE trip(
tr_id INT(11) NOT NULL AUTO_INCREMENT,
tr_departure DATETIME NOT NULL,
tr_return DATETIME NOT NULL,
tr_maxseats TINYINT(4) NOT NULL,
tr_cost FLOAT(7,2) NOT NULL,
tr_br_code INT(11) NOT NULL,
tr_gui_AT CHAR(10) NOT NULL,
tr_drv_AT CHAR(10) NOT NULL,
PRIMARY KEY(tr_id),
FOREIGN KEY(tr_br_code) REFERENCES branch (br_code)
ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY(tr_gui_AT) REFERENCES guide (gui_AT)
ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (tr_drv_AT) REFERENCES driver (drv_AT)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE travel_to(
to_tr_id INT(11) NOT NULL,
to_dst_id INT(11) NOT NULL,
to_arrival DATETIME NOT NULL,
to_departure DATETIME NOT NULL,
PRIMARY KEY(to_tr_id,to_dst_id),
FOREIGN KEY (to_dst_id) REFERENCES destination (dst_id)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE destination(
dst_id INT(11) NOT NULL AUTO_INCREMENT,
dst_name VARCHAR(50) NOT NULL,
dst_descr TEXT,
dst_rtype ENUM('LOCAL','ABROAD') NOT NULL,
dst_language VARCHAR(30) NOT NULL,
dst_location INT(11) NOT NULL,
PRIMARY KEY(dst_id),
FOREIGN KEY (dst_location) REFERENCES destination (dst_id)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE reservation(
res_tr_id INT(11) NOT NULL,
res_seatnum TINYINT(4) NOT NULL,
res_name VARCHAR(20) NOT NULL,
res_lname VARCHAR(20) NOT NULL,
res_isadult ENUM('ADULT','MINOR') DEFAULT 'ADULT',
PRIMARY KEY(res_tr_id, res_seatnum),
FOREIGN KEY (res_tr_id) REFERENCES trip (tr_id)
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE admin(
adm_AT CHAR(10) NOT NULL,
adm_type ENUM('LOGISTICS','ADMINISTRATIVE','ACCOUNTING') NOT NULL,
adm_diploma VARCHAR(200),
PRIMARY KEY(adm_AT),
FOREIGN KEY (adm_AT) REFERENCES worker (wrk_AT) 
ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE event(
ev_tr_id INT(11) NOT NULL,
ev_start DATETIME NOT NULL,
ev_end DATETIME NOT NULL,
ev_descr TEXT,
PRIMARY KEY(ev_tr_id,ev_start),
FOREIGN KEY(ev_tr_id) REFERENCES trip (tr_id) 
ON DELETE CASCADE ON UPDATE CASCADE);

# INSERT INTO TABLES
INSERT INTO phones VALUES
(1111,'2075805510'),
(1111,'2075806610'),
(1112,'2072131904'),
(1113,'2079881232'),
(1114,'2071233599'),
(1115,'1615279300'),
(1116,'1611239300'),
(1116,'1619892984'),
(1117,'1218756314'),
(1118,'1212364653'),
(1118,'1215758752'),
(1119,'1213O13213'),
(1120,'1215487510');

